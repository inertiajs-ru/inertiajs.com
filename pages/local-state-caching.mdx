import dedent from 'dedent-js'
import Layout from '../components/Layout'
import TabbedCodeExamples from '../components/TabbedCodeExamples'

export default Layout
export const meta = {
  title: 'Кэширование локального состояния',
  links: [
    { url: '#top', name: 'Вступление' },
    { url: '#запоминание-локального-состояния', name: 'Запоминание локального состояния' },
    { url: '#несколько-компонентов', name: 'Несколько компонентов' },
  ],
}

# Кэширование локального состояния

При навигации по истории браузера Inertia перезагружает страницы, используя данные, кэшированные в истории. Однако инерция не кэширует состояние локального компонента, поскольку оно недоступно. Это может привести к появлению устаревших страниц в истории Вашего браузера.

Например, если пользователь частично заполняет форму, затем уходит, а затем возвращается обратно, форма будет сброшена, и его работа будет потеряна.

## Запоминание локального состояния

Чтобы смягчить эту проблему, Вы можете указать Inertia, какое состояние локального компонента следует кэшировать в истории браузера.

<TabbedCodeExamples
  examples={[
    {
      name: 'Vue.js',
      description: 'Используйте свойство "remember" для кеширования локального состояния.',
      language: 'js',
      code: dedent`
        {
          // Option 1: Object
          remember: {
            data: ['form'],
          },\n
          // Option 2: Array
          remember: ['form'],\n
          // Option 3: String
          remember: 'form',\n
          data() {
            return {
              form: {
                first_name: null,
                last_name: null,
                // ...
              },
            }
          },
        }
      `,
    },
    {
      name: 'React',
      description: 'Используйте хук "useRememberedState" для кеширования локального состояния.',
      language: 'jsx',
      code: dedent`
        import { useRememberedState } from '@inertiajs/inertia-react'
        import React from 'react'\n
        export default function Profile() {
          const [formState, setFormState] = useRememberedState({
            first_name: null,
            last_name: null,
            // ...
          })\n
          // ...
        }
      `,
    },
    {
      name: 'Svelte',
      description: 'Используйте "remember" для кеширования локального состояния.',
      language: 'js',
      code: dedent`
        import { remember } from '@inertiajs/inertia-svelte'\n
        let form = remember({
          first_name: null,
          last_name: null,
        })\n
        // ...
      `,
    },
  ]}
/>

## Несколько компонентов

Если Ваша страница содержит несколько компонентов, использующих функцию запоминания, Вам необходимо предоставить уникальный ключ для каждого компонента. Например, `Users/Create`.

Если у Вас есть несколько экземпляров одного и того же компонента на странице, обязательно укажите уникальный идентификатор для каждого из этих экземпляров. Например, `Users/Edit:{id}`.

<TabbedCodeExamples
  examples={[
    {
      name: 'Vue.js',
      language: 'js',
      code:
        dedent`
        {
          remember: {
            data: ['form'],
            key: () =>` +
        `\`Users/Edit:\${this.user.id}\`` +
        dedent`,
          },
          data() {
            return {
              form: {
                first_name: this.user.first_name,
                last_name: this.user.last_name,
                // ...
              },
            }
          },
        }
      `,
    },
    {
      name: 'React',
      language: 'jsx',
      code:
        dedent`
        import { useRememberedState } from '@inertiajs/inertia-react'
        import React from 'react'\n
        export default function Profile() {
          const [formState, setFormState] = useRememberedState(
            {
              first_name: props.user.first_name,
              last_name: props.user.last_name,
              // ...
            },
            ` +
        `\`Users/Edit:\${this.user.id}\`` +
        dedent`
          )\n
          // ...
        }
      `,
    },
    {
      name: 'Svelte',
      language: 'js',
      code:
        dedent`
          import { page, remember } from '@inertiajs/inertia-svelte'\n
          let form = remember({
            first_name: null,
            last_name: null,
          }, ` +
        `\`Users/Edit:\${$page.props.user.id}\`` +
        dedent`)\n
          // ...
      `,
    },
  ]}
/>
