import dedent from 'dedent-js'
import Layout from '../components/Layout'
import TabbedCodeExamples from '../components/TabbedCodeExamples'

export default Layout
export const meta = {
  title: 'Состояние запоминания',
  links: [{ url: '#top', name: 'Введение' }, { url: '#multiple-components', name: 'Несколько компонентов' }],
}

# Состояние запоминания

При навигации по истории браузера Inertia восстанавливает страницы, используя данные, кэшированные в истории. Однако Inertia не восстанавливает состояние компонента локальной страницы, поскольку это недоступно. Это может привести к появлению устаревших страниц в истории Вашего браузера.

Например, если пользователь частично заполняет форму, затем уходит, а затем возвращается обратно, форма будет сброшена, и его работа будет потеряна.

Чтобы смягчить эту проблему, Вы можете указать Inertia, какое состояние локального компонента следует сохранить в истории браузера.

<TabbedCodeExamples
  examples={[
    {
      name: 'Vue.js',
      description: 'Используйте свойство "remember".',
      language: 'js',
      code: dedent`
        {
          // Вариант 1: Объект
          remember: {
            data: ['form'],
          },\n
          // Вариант 2: Массив
          remember: ['form'],\n
          // Вариант 3: Строка
          remember: 'form',\n
          data() {
            return {
              form: {
                first_name: null,
                last_name: null,
                // ...
              },
            }
          },
        }
      `,
    },
    {
      name: 'React',
      description: 'Используйте хук "useRememberedState".',
      language: 'jsx',
      code: dedent`
        import { useRememberedState } from '@inertiajs/inertia-react'
        import React from 'react'\n
        export default function Profile() {
          const [formState, setFormState] = useRememberedState({
            first_name: null,
            last_name: null,
            // ...
          })\n
          // ...
        }
      `,
    },
    {
      name: 'Svelte',
      description: 'Используйте стор "remember".',
      language: 'js',
      code: dedent`
        import { remember } from '@inertiajs/inertia-svelte'\n
        let form = remember({
          first_name: null,
          last_name: null,
        })\n
        // ...
      `,
    },
  ]}
/>

Теперь, когда Ваша локальная форма `form` изменяется, Inertia автоматически сохраняет эти данные в состояние истории и восстанавливает их при навигации по истории.

## Несколько компонентов

Если Ваша страница содержит несколько компонентов, которые используют функцию запоминания, Вам необходимо предоставить уникальный идентификатор для каждого компонента, чтобы Inertia знала, какие данные нужно восстановить для каждого компонента.

<TabbedCodeExamples
  examples={[
    {
      name: 'Vue.js',
      language: 'js',
      code: dedent`
        {
          remember: {
            data: ['form'],
            key: 'Users/Create',
          },
          data() {
            return {
              form: {
                first_name: null,
                last_name: null,
              },
            }
          },
        }
      `,
    },
    {
      name: 'React',
      language: 'jsx',
      code: dedent`
        import { useRememberedState } from '@inertiajs/inertia-react'
        import React from 'react'\n
        export default function Profile() {
          const [formState, setFormState] = useRememberedState({
            first_name: null,
            last_name: null,
          }, 'Users/Create')\n
        }
      `,
    },
    {
      name: 'Svelte',
      language: 'js',
      code: dedent`
          import { page, remember } from '@inertiajs/inertia-svelte'\n
          let form = remember({
            first_name: null,
            last_name: null,
          }, 'Users/Create')\n
      `,
    },
  ]}
/>

Если у Вас есть несколько экземпляров одного и того же компонента на странице, использующей функцию запоминания, не забудьте также включить уникальный идентификатор для каждого экземпляра компонента.

<TabbedCodeExamples
  examples={[
    {
      name: 'Vue.js',
      language: 'js',
      code: dedent`
        {
          remember: {
            data: ['form'],
            key: () => \`Users/Edit:\${this.user.id}\`,
          },
          data() {
            return {
              form: {
                first_name: this.user.first_name,
                last_name: this.user.last_name,
              },
            }
          },
        }
      `,
    },
    {
      name: 'React',
      language: 'jsx',
      code: dedent`
        import { useRememberedState } from '@inertiajs/inertia-react'
        import React from 'react'\n
        export default function Profile() {
          const [formState, setFormState] = useRememberedState({
            first_name: props.user.first_name,
            last_name: props.user.last_name,
          }, \`Users/Edit:\${this.user.id}\`)
        }
      `,
    },
    {
      name: 'Svelte',
      language: 'js',
      code: dedent`
          import { page, remember } from '@inertiajs/inertia-svelte'\n
          let form = remember({
            first_name: $page.props.user.first_name,
            last_name: $page.props.user.last_name,
          }, \`Users/Edit:\${$page.props.user.id}\`)
      `,
    },
  ]}
/>
